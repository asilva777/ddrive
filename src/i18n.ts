// --- Localization (i18n) ---
export const translations = {
    en: {
        welcome_title: "Welcome, {{role}}!",
        welcome_text: "{{description}}<br><br>Let's take a quick tour of your personalized dashboard.",
        dashboard_title: "Your Command Center",
        dashboard_text: "This is your dashboard. At a glance, monitor total risks, critical alerts, and your Unified Risk Score.",
        media_upload_title: "Step 1: Provide Context",
        media_upload_text: "Start by uploading an image or video using the 'Choose File' button. You can also add a URL, location data, and a descriptive prompt to guide the AI.",
        analysis_controls_title: "Step 2: Fine-Tune Analysis",
        analysis_controls_text: "Before assessing, you can select which specific risk categories the AI should focus on for a more targeted assessment.",
        assess_button_title: "Step 3: Start the Assessment",
        assess_button_text: "When you're ready, click here to have the AI perform its comprehensive risk assessment. This may take a moment.",
        risk_register_title: "View the Risk Register",
        risk_register_text: "After an assessment, all identified risks are logged here. You can change a risk's status with the dropdown and export your findings to CSV.",
        reports_title: "Read the AI Report",
        reports_text: "The AI's detailed narrative report appears here. Premium users can export this as a PDF for stakeholders.",
        team_comm_title: "Use the Team Hub",
        team_comm_text: "See who's online and broadcast alerts or contact emergency services instantly using these buttons.",
        profile_title: "Manage Your Profile",
        profile_text: "Click here to manage your plan, restart this tour, or log out. You can also chat with AI DDRiVER for help anytime via the floating button.",
        next_button: "Next",
        prev_button: "Previous",
        skip_button: "Skip",
        finish_button: "Finish",
        help_button: "Need Help?",
        chatbot_title: "AI DDRiVER",
        chatbot_greeting: "Hello! I'm AI DDRiVER, your assistant for the DDRiVE platform. How can I help you today?",
        chatbot_placeholder: "Ask about DDRiVE features...",
        // --- Role-Specific Onboarding Text (Manager) ---
        dashboard_text_manager: "From your Command Center, get a high-level overview of all operational risks. Pay close attention to the Unified Risk Score and Critical Alerts to prioritize actions.",
        risk_register_title_manager: "Manage the Risk Register",
        risk_register_text_manager: "As a Manager, this is your primary view. Track all identified risks, manage their status to 'Mitigated' or 'Closed', and oversee your team's mitigation efforts.",
        reports_title_manager: "Generate Stakeholder Reports",
        reports_text_manager: "After an assessment, you can read the AI's detailed narrative here. As a Premium user, you can export this as a PDF, which is crucial for stakeholder briefings and compliance audits.",
        // --- Role-Specific Onboarding Text (Operator) ---
        media_upload_title_operator: "Step 1: Upload Field Media",
        media_upload_text_operator: "As an Operator, your main task is to provide real-time data. Start by uploading an image or video from the field. Add location data and a prompt for a more accurate AI assessment.",
        assess_button_text_operator: "Click here to send your field data for immediate AI analysis. You'll be alerted to any critical risks.",
        team_comm_title_operator: "Instantly Broadcast Alerts",
        team_comm_text_operator: "If the AI finds a critical risk or you witness an urgent situation, use the Team Hub to broadcast an alert to your manager and team instantly."
    },
    fil: {
        welcome_title: "Maligayang pagdating, {{role}}!",
        welcome_text: "{{description}}<br><br>Tingnan natin sandali ang iyong personalized na dashboard.",
        dashboard_title: "Ang Iyong Command Center",
        dashboard_text: "Ito ang iyong dashboard. Mabilis na subaybayan ang kabuuang mga panganib, kritikal na alerto, at ang iyong Unified Risk Score.",
        media_upload_title: "Hakbang 1: Magbigay ng Konteksto",
        media_upload_text: "Magsimula sa pag-upload ng larawan o video gamit ang 'Choose File' button. Maaari ka ring magdagdag ng URL, data ng lokasyon, at deskriptibong prompt para gabayan ang AI.",
        analysis_controls_title: "Hakbang 2: Ayusin ang Pagsusuri",
        analysis_controls_text: "Bago magsuri, maaari mong piliin kung anong mga partikular na kategorya ng panganib ang dapat pagtuunan ng AI para sa mas target na pagtatasa.",
        assess_button_title: "Hakbang 3: Simulan ang Pagtatasa",
        assess_button_text: "Kapag handa ka na, i-click dito para isagawa ng AI ang komprehensibong pagtatasa ng panganib. Maaaring tumagal ito nang ilang sandali.",
        risk_register_title: "Tingnan ang Rehistro ng Panganib",
        risk_register_text: "Pagkatapos ng pagtatasa, lahat ng natukoy na panganib ay naka-log dito. Maaari mong baguhin ang status ng isang panganib gamit ang dropdown at i-export ang iyong mga natuklasan sa CSV.",
        reports_title: "Basahin ang Ulat ng AI",
        reports_text: "Ang detalyadong ulat ng AI ay lalabas dito. Maaaring i-export ito ng mga Premium user bilang PDF para sa mga stakeholder.",
        team_comm_title: "Gamitin ang Team Hub",
        team_comm_text: "Tingnan kung sino ang online at mag-broadcast ng mga alerto o makipag-ugnayan sa mga serbisyong pang-emergency gamit ang mga button na ito.",
        profile_title: "Pamahalaan ang Iyong Profile",
        profile_text: "I-click dito para pamahalaan ang iyong plano, i-restart ang tour na ito, o mag-log out. Maaari ka ring makipag-chat sa AI DDRiVER para sa tulong anumang oras sa pamamagitan ng floating button.",
        next_button: "Susunod",
        prev_button: "Nakaraan",
        skip_button: "Laktawan",
        finish_button: "Tapusin",
        help_button: "Kailangan ng Tulong?",
        chatbot_title: "AI DDRiVER",
        chatbot_greeting: "Kamusta! Ako si AI DDRiVER, ang iyong katulong para sa DDRiVE platform. Ano ang maitutulong ko sa iyo ngayon?",
        chatbot_placeholder: "Magtanong tungkol sa mga feature...",
        // --- Role-Specific Onboarding Text (Manager) ---
        dashboard_text_manager: "Mula sa iyong Command Center, magkaroon ng pangkalahatang-ideya sa lahat ng panganib sa operasyon. Bigyang-pansin ang Unified Risk Score at Critical Alerts upang unahin ang mga aksyon.",
        risk_register_title_manager: "Pamahalaan ang Risk Register",
        risk_register_text_manager: "Bilang Manager, ito ang iyong pangunahing view. Subaybayan ang lahat ng natukoy na panganib, pamahalaan ang kanilang status sa 'Mitigated' o 'Closed', at pangasiwaan ang mga pagsisikap ng iyong team.",
        reports_title_manager: "Gumawa ng mga Ulat para sa Stakeholder",
        reports_text_manager: "Pagkatapos ng pagtatasa, maaari mong basahin ang detalyadong salaysay ng AI dito. Bilang Premium user, maaari mo itong i-export bilang PDF, na mahalaga para sa mga briefing at audit.",
        // --- Role-Specific Onboarding Text (Operator) ---
        media_upload_title_operator: "Hakbang 1: Mag-upload ng Media mula sa Field",
        media_upload_text_operator: "Bilang Operator, ang iyong pangunahing gawain ay magbigay ng real-time na data. Magsimula sa pag-upload ng larawan o video mula sa field. Magdagdag ng data ng lokasyon at prompt para sa mas tumpak na pagtatasa ng AI.",
        assess_button_text_operator: "I-click dito para ipadala ang iyong field data para sa agarang pagsusuri ng AI. Aalertuhan ka sa anumang kritikal na panganib.",
        team_comm_title_operator: "Agad na Mag-broadcast ng mga Alerto",
        team_comm_text_operator: "Kung makakita ang AI ng kritikal na panganib o makasaksi ka ng agarang sitwasyon, gamitin ang Team Hub para mag-broadcast ng alerto sa iyong manager at team."
    },
    ceb: {
        welcome_title: "Maayong pag-abot, {{role}}!",
        welcome_text: "{{description}}<br><br>Atong tan-awon kadiyot ang imong personalized nga dashboard.",
        dashboard_title: "Ang Imong Command Center",
        dashboard_text: "Kini ang imong dashboard. Sa usa ka pagtan-aw, bantayi ang kinatibuk-ang mga risgo, kritikal nga mga alerto, ug ang imong Unified Risk Score.",
        media_upload_title: "Lakang 1: Paghatag og Konteksto",
        media_upload_text: "Sugdi pinaagi sa pag-upload og hulagway o video gamit ang 'Choose File' button. Mahimo ka usab nga magdugang og URL, data sa lokasyon, ug usa ka deskriptibong prompt aron mogiya sa AI.",
        analysis_controls_title: "Lakang 2: I-adjust ang Pag-analisar",
        analysis_controls_text: "Sa dili pa mag-assess, mahimo nimong pilion kung unsang mga piho nga kategorya sa risgo ang kinahanglan nga tutokan sa AI alang sa usa ka mas gipunting nga pagtimbang-timbang.",
        assess_button_title: "Lakang 3: Sugdi ang Pagtimbang-timbang",
        assess_button_text: "Kung andam ka na, i-klik dinhi aron ipahigayon sa AI ang komprehensibong pagtimbang-timbang sa risgo. Mahimong magdugay kini og kadiyot.",
        risk_register_title: "Tan-awa ang Rehistro sa Peligro",
        risk_register_text: "Human sa usa ka pagtimbang-timbang, ang tanan nga naila nga mga peligro gi-log dinhi. Mahimo nimong usbon ang status sa usa ka risgo gamit ang dropdown ug i-export ang imong mga nakit-an sa CSV.",
        reports_title: "Basaha ang Report sa AI",
        reports_text: "Ang detalyadong report sa AI makita dinhi. Ang mga premium user maka-export niini isip PDF para sa mga stakeholder.",
        team_comm_title: "Gamita ang Team Hub",
        team_comm_text: "Tan-awa kung kinsa ang online ug i-broadcast ang mga alerto o kontaka ang mga serbisyo sa emerhensya dayon gamit kini nga mga buton.",
        profile_title: "Pagdumala sa Imong Profile",
        profile_text: "I-klik dinhi aron madumala ang imong plano, i-restart kini nga tour, o mag-log out. Mahimo ka usab nga makig-chat sa AI DDRiVER alang sa tabang bisan unsang orasa pinaagi sa floating button.",
        next_button: "Sunod",
        prev_button: "Kaniadto",
        skip_button: "Laktaw",
        finish_button: "Humanon",
        help_button: "Nanginahanglan og Tabang?",
        chatbot_title: "AI DDRiVER",
        chatbot_greeting: "Maayong adlaw! Ako si AI DDRiVER, ang imong katabang alang sa DDRiVE platform. Unsa may akong ikatabang kanimo?",
        chatbot_placeholder: "Pangutana bahin sa mga feature...",
        // --- Role-Specific Onboarding Text (Manager) ---
        dashboard_text_manager: "Gikan sa imong Command Center, pagkuha og taas nga lebel nga paglantaw sa tanang risgo sa operasyon. Hatagi'g pagtagad ang Unified Risk Score ug Critical Alerts aron unahon ang mga aksyon.",
        risk_register_title_manager: "Pagdumala sa Risk Register",
        risk_register_text_manager: "Isip usa ka Manager, kini ang imong nag-unang view. Subaybaya ang tanang naila nga mga risgo, pagdumala sa ilang status ngadto sa 'Mitigated' o 'Closed', ug bantayi ang mga paningkamot sa imong team.",
        reports_title_manager: "Paghimo og mga Report sa Stakeholder",
        reports_text_manager: "Human sa usa ka assessment, mahimo nimong basahon ang detalyadong asoy sa AI dinhi. Isip usa ka Premium user, mahimo nimo kining i-export isip PDF, nga importante alang sa mga briefing ug audit.",
        // --- Role-Specific Onboarding Text (Operator) ---
        media_upload_title_operator: "Lakang 1: Pag-upload sa Field Media",
        media_upload_text_operator: "Isip usa ka Operator, ang imong nag-unang tahas mao ang paghatag og real-time nga data. Sugdi pinaagi sa pag-upload og hulagway o video gikan sa field. Idugang ang data sa lokasyon ug usa ka prompt para sa mas tukma nga AI assessment.",
        assess_button_text_operator: "I-klik dinhi aron ipadala ang imong field data alang sa diha-diha nga pag-analisar sa AI. Maalerto ka sa bisan unsang kritikal nga mga risgo.",
        team_comm_title_operator: "Diha-diha dayon nga Pag-broadcast og mga Alerto",
        team_comm_text_operator: "Kung makakita ang AI og kritikal nga risgo o makasaksi ka og usa ka dinalian nga sitwasyon, gamita ang Team Hub aron mag-broadcast og alerto sa imong manager ug team."
    },
    war: {
        welcome_title: "Maupay nga pag-abot, {{role}}!",
        welcome_text: "{{description}}<br><br>Ato tan-awon kadiyot an imo personalized nga dashboard.",
        dashboard_title: "An Imo Command Center",
        dashboard_text: "Ini an imo dashboard. Ha usa ka pagtan-aw, bantayi an kabug-usan nga mga peligro, mga kritikal nga alerto, ngan an imo Unified Risk Score.",
        media_upload_title: "Lakang 1: Paghatag hin Konteksto",
        media_upload_text: "Pagsugod pinaagi ha pag-upload hin hulagway o video gamit an 'Choose File' button. Puyde ka gihapon magdugang hin URL, data han lokasyon, ngan usa ka deskriptibo nga prompt para maggiya han AI.",
        analysis_controls_title: "Lakang 2: I-adjust an Pag-analisar",
        analysis_controls_text: "Antes mag-assess, puyde ka pumili kon ano nga mga ispesipiko nga kategorya hin peligro an dapat tutokan han AI para hin mas target nga ebalwasyon.",
        assess_button_title: "Lakang 3: Pagsugod han Ebalwasyon",
        assess_button_text: "Kon andam ka na, i-klik dinhi para himuon han AI an komprehensibo nga ebalwasyon han peligro. Puyde ini mag-agtang hin kadali.",
        risk_register_title: "Tan-awa an Rehistro han Peligro",
        risk_register_text: "Pagkatapos han usa ka ebalwasyon, ngatanan nga naila nga mga peligro naka-log dinhi. Puyde nimo bag-uhon an status han usa ka peligro gamit an dropdown ngan i-export an imo mga nabilngan ha CSV.",
        reports_title: "Basaha an Report han AI",
        reports_text: "An detalyado nga report han AI makikita dinhi. An mga premium user puyde mag-export hini komo PDF para ha mga stakeholder.",
        team_comm_title: "Gamita an Team Hub",
        team_comm_text: "Kitaa kon hin-o an online ngan i-broadcast an mga alerto o kontaka an mga serbisyo ha emerhensya dayon gamit ini nga mga buton.",
        profile_title: "Pagdumara han Imo Profile",
        profile_text: "I-klik dinhi para madumara an imo plano, i-restart ini nga tour, o mag-log out. Puyde ka gihapon makig-chat ha AI DDRiVER para hin bulig bisan ano nga oras pinaagi han floating button.",
        next_button: "Sunod",
        prev_button: "Nahiuna",
        skip_button: "Laktaw",
        finish_button: "Tapuson",
        help_button: "Kinahanglan hin Bulig?",
        chatbot_title: "AI DDRiVER",
        chatbot_greeting: "Maupay nga adlaw! Ako hi AI DDRiVER, an imo kabulig para han DDRiVE platform. Ano an akon mahihimo para ha imo?",
        chatbot_placeholder: "Pangutana bahin sa mga feature...",
        // --- Role-Specific Onboarding Text (Manager) ---
        dashboard_text_manager: "Tikang ha imo Command Center, pagkuha hin haluag nga paglantaw han ngatanan nga mga peligro ha operasyon. Hatagi hin pagtagad an Unified Risk Score ngan Critical Alerts para unahon an mga aksyon.",
        risk_register_title_manager: "Pagdumara han Risk Register",
        risk_register_text_manager: "Komo usa ka Manager, ini an imo panguna nga paglantaw. Subaybaya an ngatanan nga naila nga mga peligro, pagdumara han ira status ngadto ha 'Mitigated' o 'Closed', ngan bantayi an mga paningkamot han imo team.",
        reports_title_manager: "Paghimo hin mga Report para ha Stakeholder",
        reports_text_manager: "Pagkatapos han usa ka assessment, puyde mo basahon an detalyado nga asoy han AI dinhi. Komo usa ka Premium user, puyde mo ini i-export komo PDF, nga importante para ha mga briefing ngan audit.",
        // --- Role-Specific Onboarding Text (Operator) ---
        media_upload_title_operator: "Lakang 1: Pag-upload hin Field Media",
        media_upload_text_operator: "Komo usa ka Operator, an imo panguna nga trabaho amo an paghatag hin real-time nga data. Pagsugod pinaagi ha pag-upload hin hulagway o video tikang ha field. Idugang an data han lokasyon ngan usa ka prompt para hin mas eksakto nga AI assessment.",
        assess_button_text_operator: "I-klik dinhi para ipadara an imo field data para hin dayon nga pag-analisar han AI. Maaalerto ka ha bisan ano nga kritikal nga mga peligro.",
        team_comm_title_operator: "Dayon nga Pag-broadcast hin mga Alerto",
        team_comm_text_operator: "Kon makakita an AI hin kritikal nga peligro o makasaksi ka hin usa ka apurahan nga sitwasyon, gamita an Team Hub para mag-broadcast hin alerto ha imo manager ngan team."
    }
};

let currentLanguage = 'en';

export function t(key: string, replacements?: { [key: string]: string }): string {
    const lang = translations[currentLanguage as keyof typeof translations] || translations.en;
    let text = lang[key as keyof typeof lang] || key;
    if (replacements) {
        Object.entries(replacements).forEach(([key, value]) => {
            text = text.replace(new RegExp(`{{${key}}}`, 'g'), value);
        });
    }
    return text;
}

interface UiElementsForLang {
    showTourStep: () => void;
    chatbotTitle: HTMLHeadingElement;
    chatbotInput: HTMLInputElement;
}

export function setLanguage(lang: string, ui: UiElementsForLang) {
    currentLanguage = translations[lang as keyof typeof translations] ? lang : 'en';
    localStorage.setItem('ddrive-language', currentLanguage);
    
    // Refresh tour if visible
    const onboardingTooltip = document.querySelector('#onboarding-tooltip') as HTMLDivElement;
    if (!onboardingTooltip.classList.contains('hidden')) {
        ui.showTourStep();
    }
    
    // Refresh chatbot UI
    ui.chatbotTitle.textContent = t('chatbot_title');
    ui.chatbotInput.placeholder = t('chatbot_placeholder');
}
